pkgname=binutils
pkgver=2.25
pkgrel=1
pkgdesc='A collection of binary tools, including a linker and an assembler'
arch=('x86_64')
url='http://www.gnu.org/software/binutils/'
license=('GPL3')
groups=('base')
depends=()
makedepends=()
options=(upx)
changelog=ChangeLog
source=(
    "http://ftp.gnu.org/gnu/${pkgname}/${pkgname}-${pkgver}.tar.bz2"
)

sha256sums=(
    '22defc65cfa3ef2a3395faaea75d6331c6e62ea5dfacfed3e2ec17b08c882923'
)


build() {
    cd "${srcdir}/${pkgname}-${pkgver}"
    sed -i -e 's/linux-gnu/linux-musl/g' \
        -e 's@LIBC=gnu@LIBC=musl@' \
        $(find . -name "confi*.guess" -o -name "confi*.sub")
    rm -f etc/standards.info
    sed -i '/^INFO/s/standards.info //' etc/Makefile.in
    mkdir "../${pkgname}-build"
    cd "../${pkgname}-build"
    LDFLAGS="-Wl,-static" \
      ../${pkgname}-${pkgver}/configure \
      --prefix='' \
      --disable-shared \
      --disable-werror \
      --disable-nls \
      --mandir=/share/man \
      --disable-install-libbfd
    echo "MAKEINFO = :" >> Makefile
    make $MAKEFLAGS tooldir=/
    make -k check
}

package() {
    cd "${srcdir}/${pkgname}-build"
    make DESTDIR="$pkgdir" tooldir=/ install-gas install-ld install-binutils
    rm -rf "${pkgdir}/info"
}
