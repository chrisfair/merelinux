pkgname=(readline readline-dev)
pkgver=7.0
pkgrel=1
pkgdesc='A library for allowing users to edit command lines as they are typed in.'
arch=('x86_64')
url='http://www.gnu.org/software/readline/'
license=('BSD')
groups=('base')
depends=()
makedepends=(libncurses-dev)
options=() # Defaults in makepkg.conf
changelog=ChangeLog

PURGE_TARGETS+=(share/info/* share/readline/*)

source=(
    "http://ftp.gnu.org/gnu/readline/${pkgname}-${pkgver}.tar.gz"
)

sha256sums=(
    750d437185286f40a369e1e4f4764eda932b9459b5ec9a731628393dd3d32334
)


build() {
    cd "${srcdir}/${pkgname}-${pkgver}"
    sed -i '/MV.*old/d' Makefile.in
    sed -i '/{OLDSUFF}/c:' support/shlib-install
    CFLAGS="$CFLAGS -fPIC" \
    ./configure \
      --prefix=''
    make $MAKEFLAGS SHLIB_LIBS=-lncurses
}

package_readline() {
    pkgfiles=(
        'lib/libhistory.so.7'
        'lib/libreadline.so.7'
        "lib/libreadline.so.${pkgver}"
        "lib/libhistory.so.${pkgver}"
    )
    depends=(
        musl
    )

    cd "${srcdir}/${pkgbase}-${pkgver}"
    make DESTDIR="${pkgdir}-tmp" install
    cd "${pkgdir}-tmp"
    set -o pipefail
    find $(printf "%s\n" ${pkgfiles[@]}) | cpio -dumpv "$pkgdir"
}

package_readline-dev() {
    pkgfiles=(
        'lib/libreadline.a'
        'lib/libreadline.so'
        'lib/libhistory.a'
        'lib/libhistory.so'
        'include'
    )
    depends=(
        readline
    )

    cd "${srcdir}/${pkgbase}-${pkgver}"
    make DESTDIR="${pkgdir}-tmp" install
    cd "${pkgdir}-tmp"
    set -o pipefail
    find $(printf "%s\n" ${pkgfiles[@]}) | cpio -dumpv "$pkgdir"
}
