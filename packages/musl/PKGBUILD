pkgname=(musl musl-devel)
pkgver=1.1.8
pkgrel=1
pkgdesc='An implementation of the C/POSIX standard library.'
arch=('x86_64')
url='http://www.musl-libc.org'
license=(LGPL BSD)
groups=('base')
depends=()
makedepends=()
options=(!upx)
changelog=ChangeLog
source=(
	"http://www.etalabs.net/musl/releases/${pkgname}-${pkgver}.tar.gz"
)
sha256sums=(
    fa928506415b9c555977daaf874c190eaf7fbbd16028cc5c5f33a00a83227813
)


build() {
	cd "${srcdir}/${pkgbase}-${pkgver}"
	sed -i 's@-Os@-O3@g' configure
	CFLAGS='' ./configure --prefix=/
	make $MAKEFLAGS
}

package_musl() {
	pkgfiles=(
		bin/ldd
		lib/libc.so
		"lib/ld-musl-${arch}.so.1"
	)

	cd "${srcdir}/${pkgbase}-${pkgver}"
	make DESTDIR="${pkgdir}-tmp" install
	cd "${pkgdir}-tmp"
	install -d bin
	ln -sf ../lib/libc.so bin/ldd
	find ${pkgfiles[@]} | cpio -pudmv "${pkgdir}"
}

package_musl-devel() {
	depends=('musl')
	cd "${srcdir}/${pkgbase}-${pkgver}"
	make DESTDIR="$pkgdir" install
	rm "${pkgdir}/lib/libc.so"
	rm "${pkgdir}/lib/ld-musl-${arch}.so.1"
}
